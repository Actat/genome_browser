/**
 * @author Hiroyuki Wakaguri: hwakagur(Î±)bits.cc (Tokyo-Univ. Yutaka Suzuki's lab.)
 */
var VERSION="kero_browse.js v1.6.20171227",MAX_HEIGHT=32766,GenomeViewerObject=function(t,i,e,s){if(this.divId=t,!$(this.divId)[0])return alert(t+" factor not found"),!1;this.chrData=i,this.urlSet=void 0===e?{}:e,void 0===s?(this.option=void 0===e?{uriDirFlg:!0}:e,this.option.uriDirFlg=!0):this.option=s,void 0===this.option.showChromFlg&&(this.option.showChromFlg=!0),void 0===this.option.showScaleFlg&&(this.option.showScaleFlg=!0),void 0===this.option.browserId&&(this.option.browserId=""),void 0===this.option.defBtnHideFlg&&(this.option.defBtnHideFlg=!1),this.gv=null,this.gvVector={};var o=this;this.gvFunc=function(){return this.gvVector=o.gvVector,{getGvOption:function(){return gvVector.gv.option},getWidth:function(){return gvVector.gv.width},getUrlSet:function(){return gvVector.gv.urlSet},getGenome:function(){return gvVector.gv.genome},getViewerParts:function(){return gvVector.gv.viewerParts},getDivId:function(){return gvVector.gv.divId},addCreateParts:function(t,i){gvVector.gv.addCreateParts(t,i)},changeTrack:function(t,i){gvVector.gv.changeTrack(t,i)},showItemFromButtonClick:function(t){gvVector.gv.showItemFromButtonClick(t)},hideItemFromButtonClick:function(t){gvVector.gv.hideItemFromButtonClick(t)},setGenomePosition:function(t,i,e,s){gvVector.gv.setGenomePosition(t,i,e,s)},paint:function(){gvVector.gv.paint()},alert:function(){alert(this.gvVector+", "+gvVector.gv)}}}(),$(t).css("text-align","left").css("line-height","normal").css("border","none");var n="";if(void 0===this.option.toolBar){n+='<div id="tool_bar">',n+="<div>";var a=15,r=a-5;n+='<button style="padding: 0px; border: none; background:none;" class="tools_btn" id="menu_button"><img src="icons/tools_btn.png" alt="Menu" id="btn1" /></button>',n+='<input style="height: '+a+"px; font-size: "+r+'px; width: 200px; position: absolute;" id="genome_position" class="ui-autocomplete-input" autocomplete="off" type="text">',n+='<button style="padding: 0px; border: none; background:none; position: absolute; left: 232px;" class="tools_btn" id="go_button"><img src="icons/tools_btn.png" alt="Menu" id="btn2" /></button>',n+='<button style="padding: 0px; border: none; background:none; position: absolute; left: 260px;" class="tools_btn" id="big5"><img src="icons/tools_btn.png" alt="Menu" id="btn3" /></button>',n+='<button style="padding: 0px; border: none; background:none; position: absolute; left: 280px;" class="tools_btn" id="big"><img src="icons/tools_btn.png" alt="Menu" id="btn4" /></button>',n+='<button style="padding: 0px; border: none; background:none; position: absolute; left: 300px;" class="tools_btn" id="bigm"><img src="icons/tools_btn.png" alt="Menu" id="btn5" /></button>',n+='<button style="padding: 0px; border: none; background:none; position: absolute; left: 320px;" class="tools_btn" id="smallm"><img src="icons/tools_btn.png" alt="Menu" id="btn6" /></button>',n+='<button style="padding: 0px; border: none; background:none; position: absolute; left: 340px;" class="tools_btn" id="small"><img src="icons/tools_btn.png" alt="Menu" id="btn7" /></button>',n+='<button style="padding: 0px; border: none; background:none; position: absolute; left: 360px;" class="tools_btn" id="small5"><img src="icons/tools_btn.png" alt="Menu" id="btn8" /></button>',n+='<button style="padding: 0px; border: none; background:none; position: absolute; left: 390px;" class="tools_btn" id="info_button"><img src="icons/tools_btn.png" alt="Info mode" id="btn9" /></button>',n+='<button style="padding: 0px; border: none; background:none; position: absolute; left: 410px;" class="tools_btn" id="nav_button"><img src="icons/tools_btn.png" alt="Browse mode" id="btn10" /></button>',n+='<button style="padding: 0px; border: none; background:none; position: absolute; left: 440px;" class="tools_btn" id="panel_button"><img src="icons/tools_btn.png" alt=" Synchronize track settings on/off" id="btn11" /></button>',n+='<button style="padding: 0px; border: none; background:none; position: absolute; left: 470px;" class="tools_btn" id="sync_button"><img src="icons/tools_btn.png" alt="" id="btn12" /></button>',n+="</div>",n+='<div id="down_menu" style="position: absolute; visibility: hidden"></div>',n+='<div id="movable_menu" style="position: absolute; border: 1px solid #aaaaaa; background-color: #dddddd; margin: 5px; display: none">',n+='	<div id="movable_close" style="cursor: pointer; float: right">X</div>',n+='	<div id="movable_title" style="cursor: move; background-color: gray; font-color: #ffffff"></div>',n+='<div id="content" style="font-size: 12px">',n+="</div>",n+="</div>",n+="</div>",void 0===this.option.onTrackAction&&(this.option.onTrackAction=function(i){var e,s=i.targetObj.getName();e="add"==i.status,$("div"+t+" #"+o.option.toolbarId+" #chkw_"+s).prop("checked",e)})}else""==this.option.toolBar?n+="":(n+='<div id="tool_bar">',n+=this.option.toolBar,n+="</div>");if(n+='<div id="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;">',n+='<div class="background" style="position: fixed; width: 100%; height: 100%; ',n+="background-color: #000000; opacity: 0.75; filter: alpha(opacity=75); ",n+="-ms-filter: 'alpha(opacity=75)';\"></div>",n+='<div class="container" style="position: relative; width: 500px; ',n+='background-color: #ffffff; overflow: auto; border-radius: 3px; padding: 5px;">',n+='<div class="container_in"></div></div></div>',n+='<div id="right_pop" style="position: absolute; visibility: hidden"></div>',n+='<div id="viewer_body"></div>',$(t).html(n),this.adjustCenter(),$(window).resize(function(){o.adjustCenter()}),$("div"+t+" div#modal div.background").click(function(){return o.displayModal(!1),!1}),$("div"+t+" #genome_position").keypress(function(t){return 13==t.which?(o.goGoButton(),!1):void 0}),this.option.backValidFlg&&window.addEventListener("popstate",function(){var t=o.gv.chr,i=parseInt(o.gv.start),e=parseInt(o.gv.end),s="-"==o.gv.strand||"-1"==o.gv.strand?"-":"+",n=o.getParsePosition(location.hash.substr(1));return n?1>i||e>o.chrData[t][1]?!1:("-"!=n[3]&&(n[3]="+"),void(t==n[0]&&i==n[1]&&e==n[2]&&s==n[3]||(o.goSetGenomePosition(n,!0),console.log("back button pushed")))):!1}),void 0===this.option.toolBar){$("div"+t+" .tools_btn").css("width","20px").css("height","20px").css("overflow","hidden");for(var h=1;12>=h;h++){var l=20*(1-h);12==h&&(l=-240),$("div"+t+" .tools_btn #btn"+h).css("position","relative").css("left",l+"px"),11==h&&$("div"+t+" .tools_btn #btn"+h).css("top","-20px")}}if(void 0!==this.urlSet.key2position){var d=void 0===this.urlSet.additionalParam?this.urlSet.key2position:this.urlSet.key2position+"?"+this.urlSet.additionalParam;$("div"+t+" #genome_position").autocomplete({source:d,open:function(){var t=$(this).autocomplete("widget"),i=t.children("li").length;i>=30&&jQuery("<li>",{className:"results",text:"..."}).appendTo(t)},minLength:2,max:10,scroll:!0})}};GenomeViewerObject.prototype={getParsePosition:function(t){if(void 0===t)return!1;var i=t.split(":");try{i[1]=i[1].replace(/^\-+/,"");var e=i[1].split(/\-|\.\./);e[0]=e[0].replace(/ |,/g,""),void 0===e[1]?e[1]=e[0]:e[1]=e[1].replace(/ |,/g,"");var s=parseInt(e[0]),o=parseInt(e[1]);if(0>s&&(s=1),0>o&&(o=1),!s||!o)return!1}catch(n){return!1}return void 0!==i[2]&&"-1"==i[2]&&(i[2]="-"),[i[0],s,o,i[2]]},setupGenomeViewer:function(t,i,e,s){void 0===s&&(s=[]),this.posStr=t;var o=(this.getParsePosition,this.chrData),n=this.divId,a=this.getCookie("viewerWidth");""!=a&&(i=parseInt(a));var r=this.getCookie("viewerHeight");""!=r&&(e=parseInt(r)),i*=1,e*=1,isFinite(i)||(i=500),isFinite(e)||(e=300);var h=new GenomeViewer(i,e,o,t,n,s,this.urlSet,this.option);this.gvVector.gv=h,this.gv=h,this.goGoButton();var l=this;return $("div"+n+" #go_button").click(function(){return l.goGoButton(),!1}),$("div"+n+" #small").click(function(){return l.changeSize(.5),!1}),$("div"+n+" #big").click(function(){return l.changeSize(2),!1}),$("div"+n+" #small5").click(function(){return l.changeSize(.2),!1}),$("div"+n+" #big5").click(function(){return l.changeSize(5),!1}),$("div"+n+" #smallm").click(function(){return l.changeSize(2/3),!1}),$("div"+n+" #bigm").click(function(){return l.changeSize(1.5),!1}),$("div"+n+" #change_size").click(function(){var t=Math.floor($("div"+n+" #viewer_width").val()),i=Math.floor($("div"+n+" #viewer_height").val());return isNaN(i)&&(i=200),200>t&&(t=200),200>i&&(i=200),t>2e3&&(t=2e3),i>2e3&&(i=2e3),l.setCookie("viewerWidth",t),l.setCookie("viewerHeight",i),l.gv.setViewerSize(t,i),!1}),$("div"+n+" #track_set").click(function(){return l.allTruckSetting(),!1}),this.gv},changeSize:function(t){var i;if(i=$("div"+this.divId+" #genome_position").size()?this.getParsePosition($("div"+this.divId+" #genome_position").val()):this.getParsePosition(location.hash.substr(1))){var e=(i[0],i[2]-i[1]+1),s=(i[2]+i[1])/2;i[1]=Math.floor(s-e/t/2),i[2]=Math.floor(s+e/t/2),this.goSetGenomePosition(i)}else alert("check format.")},searchFromTerm:function(t){var i=this,e=t,s=this.getParsePosition;if(void 0===this.urlSet.searchKey)return!1;var o=void 0===this.urlSet.additionalParam?this.urlSet.searchKey+"?term="+t+"&condition=list":this.urlSet.searchKey+"?term="+t+"&condition=list&"+this.urlSet.additionalParam;$.ajax({url:o,xhrFields:{withCredentials:this.option.withCredentials},dataType:"json",success:function(t){if(0==t.hit_num)alert("No hit found. ("+e+")");else if(1==t.hit_num){var o=s(t.source[0].location),n=o[2]-o[1]+1,a=o[1]-n/5,r=o[2]+n/5,h=void 0===o[3]?"":o[3];i.gv.setGenomePosition(o[0],a,r,h)}else{var l="<div>First 20 candidates were shown.</div><div>&nbsp;</div>";l+='<table border="1">';for(var d=0;d<t.source.length;d++){var c=t.source[d],v=c.term;if(l+="<tr><td>"+v+'</td><td><a href="'+c.location+":"+c.strand+'" class="modal">'+c.location+":"+c.strand+"</a></td></tr>",19==d)break}l+="</table>",$("div"+i.divId+" div#modal div.container").html(l),i.displayModal(!0),$("div"+i.divId+" div#modal div.container a.close").click(function(){return i.displayModal(!1),!1}),$("div"+i.divId+" a.modal").click(function(){var t=s($(this).attr("href")),e=t[2]-t[1]+1,o=t[1]-e/5,n=t[2]+e/5,a=void 0===t[3]?"":t[3];return i.gv.setGenomePosition(t[0],o,n,a),i.displayModal(!1),!1})}},error:function(){alert("Error: Cannot access to "+this.url)},complete:function(){}})},adjustCenter:function(){var t="div"+this.divId+" div#modal div.container",i=window.innerWidth?window.innerWidth:$(window).width(),e=window.innerHeight?window.innerHeight:$(window).height(),s=(e-$(t).height())/2,o=(i-$(t).width())/2;0>s&&(s=0),$(t).css({top:s+"px",left:o+"px"})},displayModal:function(t,i){t?(void 0===i&&(i=[500,600]),$("div"+this.divId+" div#modal div.container").css("width",i[0]).css("height",i[1]),$("div"+this.divId+" div#modal").fadeIn(250)):$("div"+this.divId+" div#modal").fadeOut(250),this.adjustCenter()},goGoButton:function(){var t=$("div"+this.divId+" #genome_position").val(),i=this.getParsePosition(t);if(i)this.goSetGenomePosition(i);else if(t)this.searchFromTerm($("div"+this.divId+" #genome_position").val());else if($("div"+this.divId+" #genome_position").size())alert("Please input genomic position where you want to see.");else{var e=this.getParsePosition(this.posStr);this.goSetGenomePosition(e)}},goSetGenomePosition:function(t,i){var e=t[0],s=t[1],o=t[2],n=t[3];return 1>s&&(s=1),e in this.chrData?(o>this.chrData[e][1]&&(o=this.chrData[e][1]),void this.gv.setGenomePosition(e,s,o,n,i)):(alert("Error: chromosome: "+e+" not found."),!1)},getAddSeparatorButton:function(){return'<span><input type="button" id="sep" value="Add separator" />'},getClearAllTracksButton:function(){return'<input type="button" id="del_item" value="Clear all tracks" name="." /></span>'},allTruckSetting:function(){var t=this;$("div"+this.divId+" #right_pop").css("visibility","hidden");for(var i={},e=0;e<t.gv.viewerPartsAll.length;e++)if("separator"!=t.gv.viewerPartsAll[e].getName()&&void 0!==t.gv.viewerPartsAll[e].getAllSettingsData)for(var s=t.gv.viewerPartsAll[e].getAllSettingsData(t.divId),o=0;o<s.length;o++)void 0===i[s[o].id]&&(i[s[o].id]={title:s[o].title,html:s[o].html,functionList:[]}),i[s[o].id].functionList.push(s[o].onChange);var n="";n+="<form><div><strong>Configure all trucks</strong></div>",n+='<div class="modal_inbox">',n+='<table border="0" width="100%"><tr><td align="center">',n+='<table border="1">';for(var a in i)n+="<tr><td>"+i[a].title+"</td>",n+="<td>"+i[a].html+"</td>",n+='<td><input type="button" id="change_'+a+'" value="Change" /></td>',n+="</tr>\n";n+="</table>",n+="</td></tr></table></div>",n+='<div class="modal_btn"><input type="button" id="cancel_alltruck" value="Cancel" /></div>',n+="</form>",$("div"+this.divId+" div#modal div.container").html(n);for(var a in i)$("div"+this.divId+" div#modal div.container #change_"+a).click(function(){for(var e=i[this.id.substr(7)].functionList,s=0;s<e.length;s++)e[s]();return t.displayModal(!1),t.gv.paint(),!1});$("div"+this.divId+" div#modal div.container #cancel_alltruck").click(function(){return t.displayModal(!1),!1}),this.displayModal(!0,[400,300])},getCookie:function(t){var i=document.cookie+";",e=i.indexOf(t+"=",0);if(-1!=e){var s=i.substring(e,i.length),o=s.indexOf("=",0)+1,n=s.indexOf(";",o);return unescape(s.substring(o,n))}return""},setCookie:function(t,i){if(i=String(i),-1!=i.indexOf(";",0)||-1!=i.indexOf("=",0))return!1;var e=new Date;e.setTime(e.getTime()+1e10);var s=t+"="+escape(i)+"; ";return s+="expires="+e.toGMTString()+";",document.cookie=s,!0}};var GenomeViewerCommonData=function(){this.loadingData={},this.json={},this.callBackObj=[],this.chrData=null};GenomeViewerCommonData.prototype={getLoadingData:function(){return this.loadingData},getJson:function(){return this.json},getCallBackObj:function(){return this.callBackObj},getChrData:function(){return this.chrData}};var POW_REG=1e4,GenomeViewer=function(t,i,e,s,o,n,a,r){this.ochr=null,this.divId=o,this.urlSet=a,this.option=void 0===r?{}:r,this.option.itemSwitchFlg=void 0===r.itemSwitchFlg?!0:r.itemSwitchFlg,this.option.autoSizingFlg=void 0===r.autoSizingFlg?!1:r.autoSizingFlg,this.option.toolbarId=void 0!==r.toolbarId?r.toolbarId:"tool_bar",this.option.viewerId=void 0!==r.viewerId?r.viewerId:"viewer_body",this.option.ibuttonId=void 0!==r.ibuttonId?r.ibuttonId:"items_button",this.option.scaleSizingFlg=void 0===r.scaleSizingFlg?!0:r.scaleSizingFlg,this.option.chromSizingFlg=void 0===r.chromSizingFlg?!0:r.chromSizingFlg,this.option.dblclickSizingFlg=void 0===r.dblclickSizingFlg?!0:r.dblclickSizingFlg,void 0===this.option.boderCss&&(this.option.boderCss=1),this.option.itemTrans=void 0===r.itemTrans?!1:r.itemTrans,this.option.edgePreventFlg=void 0===r.edgePreventFlg?!1:r.edgePreventFlg,this.option.linkAdd=void 0===r.linkAdd?"":r.linkAdd,this.option.locationBarFlg=void 0===r.locationBarFlg?!0:r.locationBarFlg,this.option.uriDirFlg=void 0===r.uriDirFlg?!1:r.uriDirFlg,this.option.chrUriDirFlg=void 0===r.chrUriDirFlg?!1:r.chrUriDirFlg,this.panelPopup={},this.accNo=0,this.viewerPartsAll=[];for(var h=0;h<n.length;h++)if(Array.isArray(n[h])){if("string"==typeof n[h][0])continue;this.viewerPartsAll.push(n[h][0])}else{if("string"==typeof n[h])continue;this.viewerPartsAll.push(n[h])}this.chrBaseY=void 0!==r.showPositionFlg&&r.showPositionFlg?10:0,this.relYSpace=15,this.scrollY=0,this.width=t,this.height=i,this.genome=e,this.chr=null,this.start=null,this.end=null,this.strand=null,this.toolBarCss=void 0===this.option.toolBar?{padding:1,height:20}:void 0===this.option.toolBarCss?{padding:5}:this.option.toolBarCss;var l="div"+o+" #"+this.option.toolbarId,d=$(l+" #setting_sync");this.settingSyncFlg=d[0]?$(l+" #setting_sync").is(":checked"):!1,this.settingSyncFlg?$(l+" .tools_btn #btn12").css("top","-20px"):$(l+" .tools_btn #btn12").css("top","0px");var c=$(l+" #item_view");this.itemShowFlg=c[0]?$(l+" #item_view").is(":checked"):void 0!==r.showPanelFlg?r.showPanelFlg:!0,this.itemShowFlg?$(l+" .tools_btn #btn11").css("left","-200px"):$(l+" .tools_btn #btn11").css("left","-220px"),void 0===r.commonData?(this.json={},this.loadingData={}):(this.json=r.commonData.getJson(),this.loadingData=r.commonData.getLoadingData(),r.commonData.getCallBackObj().push(this)),this.mode=r.defaultMode?r.defaultMode:"nav",$(l+" input[name='viewer_mode']").val([this.mode]),"info"==this.mode?($(l+" .tools_btn #btn9").css("top","-20px"),$(l+" .tools_btn #btn10").css("top","0px")):($(l+" .tools_btn #btn9").css("top","0px"),$(l+" .tools_btn #btn10").css("top","-20px")),this.infoData={},$(l).css("white-space","nowrap").css("padding",this.toolBarCss.padding).css("width",this.width+2*this.option.boderCss-2*this.toolBarCss.padding).css("background-color","gray"),void 0!==this.toolBarCss.height&&$(l).css("height",this.toolBarCss.height),$(l+" #db_name").css("height","30"),$(l+" #genome_position").val(s),$("div"+o+" #"+this.option.viewerId).append('<canvas id="main_viewer" width="'+this.width+'" height="'+this.height+'">Sorry. Unsupported browser</canvas>'),$("div"+o+" #"+this.option.viewerId+" #main_viewer").css("border",this.option.boderCss+"px solid"),this.option.showChromFlg&&(this.ochr=new WgChr(this,this.urlSet.additionalParam,this.chrBaseY,this.relYSpace,e,{withCredentials:this.option.withCredentials,chrBoxCol:this.option.chrBoxCol,chrUriDirFlg:this.option.chrUriDirFlg,chrData:this.option.chrData})),this.viewerParts=[],this.initViewer();var v=this;if(this.errorParts={},this.option.itemSwitchFlg){var g=[],p="";p+='<div id="'+this.option.ibuttonId+'">',this.option.defBtnHideFlg||(p+='<span><input type="button" id="sep" value="Add separator" />',p+='<input type="button" id="del_item" value="Clear all tracks" name="." /></span>');for(var h=0;h<n.length;h++){var u=[];if(u=Array.isArray(n[h])?n[h]:[n[h],!1],"string"!=typeof u[0]){var f=u[0].getName(),m=u[0].getItemDispName(),w=u[0].getButtonInfo();if("separator"!=f&&!this.option.trackBtnHideFlg)if(w.onOff){var b=u[1]?"on":"off";p+='<input class="track_button" type="button" id="'+f+'" value="'+b+'" />'}else p+='<input class="track_button" type="button" id="'+f+'" value="'+m+'" />';if(u[1]){this.viewerParts.push(u[0]);var _=w.color[1];"separator"!=f&&g.push([f,_])}else{var _=w.color[0];"separator"!=f&&g.push([f,_])}}else this.option.trackBtnHideFlg||(p+=u[0])}p+="</div>",$("div"+o+" #"+this.option.btnSpaceId)[0]?$("div"+o+" #"+this.option.viewerId)[0]&&$("div"+o+" #"+this.option.btnSpaceId).html(p):$("div"+o).append(p);for(var h=0;h<g.length;h++)$("div"+o+" #"+this.option.ibuttonId+" #"+g[h][0]).css("background-color","#"+g[h][1])}else for(var h=0;h<n.length;h++)Array.isArray(n[h])&&n[h][1]&&this.viewerParts.push(n[h][0]);this.option.onresizeSetWidth&&(window.onresize=function(){var t=v.option.onresizeSetWidth();v.setViewerSize(t,v.height)}),$("div"+o+" #"+this.option.ibuttonId+" #sep").click(function(){var t=new WgSeparator(3,"#777777");return t.setImgJson(v.mCc),v.viewerPartsAll.push(t),v.viewerParts.push(t),v.paint(),!1}),$("div"+o+" #"+this.option.ibuttonId+" #del_item").click(function(){for(var t=new RegExp(this.name),i=0;i<v.viewerPartsAll.length;i++){var e=v.viewerPartsAll[i].getName(),s=v.viewerPartsAll[i].getItemDispName();if(s.match(t))for(var o=0;o<v.viewerParts.length;o++)if(e==v.viewerParts[o].getName()){v.deleteViwerParts(o);break}}if("separator".match(t)){for(var n=[],i=0;i<v.viewerPartsAll.length;i++)"separator"!=v.viewerPartsAll[i].getName()&&n.push(v.viewerPartsAll[i]);v.viewerPartsAll=n}return v.paint(),!1}),$("div"+o+" #"+this.option.ibuttonId+" #show_itemid").click(function(){for(var t=this.name.split("|"),i=[],e=0;e<t.length;e++)i[t[e]]=!0;for(var s=[],e=0;e<v.viewerPartsAll.length;e++){var o=v.viewerPartsAll[e].getName();if(i[o]&&"separator"!=o){for(var n=!1,a=0;a<v.viewerParts.length;a++)if(o==v.viewerParts[a].getName()){n=!0;break}n||s.push(e)}}for(var e=0;e<s.length;e++)v.addViwerParts(s[e],!0);return v.paint(),!1}),$("div"+o+" #"+this.option.ibuttonId+" #hide_itemid").click(function(){for(var t=this.name.split("|"),i=[],e=0;e<t.length;e++)i[t[e]]=!0;for(var s=!0;s;){s=!1;for(var e=0;e<v.viewerParts.length;e++){var o=v.viewerParts[e].getName();if(i[o]&&"separator"!=m){s=!0;break}}s&&v.deleteViwerParts(e)}return v.paint(),!1}),$("div"+o+" #"+this.option.ibuttonId+" #show_item").click(function(){return v.showItemFromButtonClick(this.name),!1}),$("div"+o+" #"+this.option.ibuttonId+" #hide_item").click(function(){return v.hideItemFromButtonClick(this.name),!1});for(var h=0;h<n.length;h++){var u;if(u=Array.isArray(n[h])?n[h][0]:n[h],"string"!=typeof u){var f=u.getName();$("div"+o+" #"+this.option.ibuttonId+" #"+f).click(function(){for(var t=$(this).attr("id"),i=0;i<v.viewerPartsAll.length;i++)if(v.viewerPartsAll[i].getName()==t){var e=!v.viewerPartsAll[i].comparaFlg;v.addViwerParts(i,e);break}return v.paint(),!1})}}this.startX,this.renderStartX,$(l+" #setting_sync").on("change",function(){$(this).is(":checked")?v.settingSyncFlg=!0:v.settingSyncFlg=!1}),$(l+" #sync_button").click(function(){return v.settingSyncFlg?(v.settingSyncFlg=!1,$(l+" .tools_btn #btn12").css("top","0px")):(v.settingSyncFlg=!0,$(l+" .tools_btn #btn12").css("top","-20px")),!1}),$(l+" #item_view").on("change",function(){$(this).is(":checked")?(v.itemShowFlg=!0,v.paint()):(v.itemShowFlg=!1,v.paintRender(0))}),$(l+" #panel_button").click(function(){return v.itemShowFlg?(v.itemShowFlg=!1,$(l+" .tools_btn #btn11").css("left","-220px"),v.paintRender(0)):(v.itemShowFlg=!0,$(l+" .tools_btn #btn11").css("left","-200px"),v.paint()),!1}),$(l+" input[name='viewer_mode']").change(function(){v.mode=$("div"+o+" input[name='viewer_mode']:checked").val(),"info"==v.mode&&(v.infoData=v.getPopupInfoData()),v.paint()}),$(l+" #info_button").click(function(){return"info"!=v.mode&&(v.mode="info",$(l+" .tools_btn #btn9").css("top","-20px"),$(l+" .tools_btn #btn10").css("top","0px"),v.infoData=v.getPopupInfoData(),v.paint()),!1}),$(l+" #nav_button").click(function(){return"info"==v.mode&&(v.mode="nav",$(l+" .tools_btn #btn9").css("top","0px"),$(l+" .tools_btn #btn10").css("top","-20px"),v.paint()),!1});for(var P={},h=0;h<this.viewerPartsAll.length;h++){var C=this.viewerPartsAll[h].getName();P[C]=h}if(""!=this.option.browserId&&this.getCookie(this.option.browserId+"|")){var y=this.getCookie(this.option.browserId+"|").split("|");this.setCookie(this.option.browserId+"|","");for(var h=0;h<y.length;h++){var k=y[h];if("separator"!=k&&void 0!==P[k]){var S=P[k],F=void 0!==y[h+1]&&"separator"==y[h+1];this.addViwerParts(S,F)}}}else if(void 0!==r.initShow)for(var h=0;h<r.initShow.length;h++){var F=!0,S=r.initShow[h];if(isNaN(S)){if(void 0===P[S[0]])continue;F=S[1],S=P[S[0]]}this.addViwerParts(S,F)}if(void 0===this.option.toolBar){$(l).css("position","relative");for(var I=[["menu_button",-3,"btn1","Menu"],["go_button",215,"btn2","Search"],["big5",230,"btn3","x5 Zoom in"],["big",250,"btn4","x2 Zoom in"],["bigm",270,"btn5","x1.5 Zoom in"],["smallm",280,"btn6","x2/3 Zoom out"],["small",300,"btn7","x1/2 Zoom out"],["small5",320,"btn8","x1/5 Zoom out"],["info_button",370,"btn9","Info mode"],["nav_button",380,"btn10","Browse mode"],["panel_button",390,"btn11","Left panel (on/off)"],["sync_button",370,"btn12","Synchronize track settings (on/off)"]],h=0;h<I.length;h++)!function(){var t=I[h];$(l+" #"+t[0]).hover(function(){if("btn11"==t[2]){var i=v.itemShowFlg?-220:-200;$(l+" .tools_btn #btn11").css("left",i+"px")}else{var i="btn12"==t[2]&&v.settingSyncFlg?0:-20;$(l+" .tools_btn #"+t[2]).css("top",i+"px")}return $(l).append('<span id="pop">'+t[3]+"</span>"),$(l+" #pop").css("position","absolute").css("left",t[1]+"px").css("top","-25px").css("background","#666666").css("color","#ffffff").css("font-size","15px").css("padding","3px"),!1},function(){if("btn11"==t[2]){var i=v.itemShowFlg?-200:-220;$(l+" .tools_btn #btn11").css("left",i+"px")}else{var i;"btn9"!=t[2]&&"btn10"!=t[2]&&"btn12"!=t[2]||"btn9"==t[2]&&"info"!=v.mode||"btn10"==t[2]&&"info"==v.mode||"btn12"==t[2]&&!v.settingSyncFlg?i=0:"btn12"==t[2]&&v.settingSyncFlg&&(i=-20),void 0!==i&&$(l+" .tools_btn #"+t[2]).css("top",i+"px")}return $(l+" #pop").remove(),!1})}();$(l+" #menu_button").click(function(){var t=100,i=100,e=$(l+" #menu_button").outerHeight(!0);if("hidden"==$(l+" #down_menu").css("visibility")){var s="";s+='<div id="track">Track...</div>',s+='<div id="save_img">Save image</div><hr />',s+='<div id="setting">Settings...</div><hr />',s+='<div id="help"><a href="https://dbtss.hgc.jp/?doc:help_2017.html" target="_blank">Help</a></div>',s+='<div id="about">About</div>',s+='<form action="https://dbtss.hgc.jp/cgi-bin/return_img.cgi" method="POST" name="post_img" id="post_img">',s+='<input type="hidden" name="imagedata" value="">',s+='<input type="hidden" name="filename" value="kero_viewer.png">',s+="</form>",$(l+" #down_menu").html(s),$(l+" #down_menu").css("top",e+2).css("border","solid 1px").css("background-color","#FFFFFF").css("color","#000000").css("border-radius","1px").css("padding","5px").css("box-shadow","5px 5px 5px 0px rgba(200,200,200,0.8)").css("visibility","visible");for(var n=["track","save_img","setting","help","about"],a=0;a<n.length;a++)!function(){var t=n[a];$(l+" #down_menu #"+t).hover(function(){$(l+" #down_menu #"+t).css("background-color","gray")},function(){$(l+" #down_menu #"+t).css("background-color","white")})}();$(l+" #down_menu #save_img").click(function(){var t=$("div"+o+" #"+v.option.viewerId+" #main_viewer")[0],i=t.toDataURL("image/png");i=i.replace(/^.*,/,"");var e=$(l+" #down_menu #post_img")[0];return e.imagedata.value=i,e.submit(),!1}),$(l+" #down_menu #about").click(function(){return $(l+" #movable_title").html("About kero_browse.js"),$(l+" #content").html(VERSION),$(l+" #movable_menu").css({top:t,left:i}).fadeIn(100),$(l+" #down_menu").css("visibility","hidden"),!1}),$(l+" #down_menu #track").click(function(){$(l+" #movable_title").html("Tracks");var e="";return e+='<div id="list_line"><table><tr><td width="10"><span id="list">+</span></td><td>List</td></tr></table></div>',e+='<div id="list_content" style="display: none; padding: 10px">',e+="loading...",e+="</div><hr />",e+='<div id="localfile_line"><table><tr><td width="10"><span id="localfile">+</span></td><td>Local files (bigWig or bam,bai)</td></tr></table></div>',e+='<div id="localfile_content" style="display: none; padding: 10px">',e+="<div>Using your local PC files (without uploading)</div>",e+='<div><input type="file" id="files" name="file" multiple /> ',e+='<input type="button" value="Add local BAM(.bam and .bai) or bigWig(.bw) track" id="add_bam" /></div>',e+="</div>",$(l+" #content").html(e),$(l+" #movable_menu").css({top:t,left:i}).fadeIn(100),$(l+" #down_menu").css("visibility","hidden"),$(l+" #localfile_line").off("click"),$(l+" #localfile_line").on("click",function(){var t="+"==$(l+" #localfile").html()?"-":"+";return $(l+" #localfile").html(t),$(l+" #localfile_content").slideToggle("normal",function(){}),!1}),$(l+" #localfile_line").hover(function(){$(l+" #localfile_line").css("background-color","#BBBBBB")},function(){$(l+" #localfile_line").css("background-color","#DDDDDD")}),$(l+" #list_line").off("click"),$(l+" #list_line").on("click",function(){var t="+"==$(l+" #list").html()?"-":"+";return $(l+" #list").html(t),$(l+" #list_content").slideToggle("normal",function(){if("loading..."==$(l+" #list_content").html()){for(var t="",i=0;i<v.viewerPartsAll.length;i++){var e=v.viewerPartsAll[i].getName(),s=v.viewerPartsAll[i].getItemDispName();"separator"!=e&&(t+='<div><input type="checkbox" id="chkw_'+e+'" /><label for="'+e+'">'+s+"</label></div>")}$(l+" #list_content").html(t);for(var i=0;i<v.viewerParts.length;i++){var e=v.viewerParts[i].getName();$(l+" #chkw_"+e).prop("checked","checked")}for(var i=0;i<v.viewerPartsAll.length;i++){var e=v.viewerPartsAll[i].getName();$(l+" #chkw_"+e).change(function(){var t=$(this).attr("id").substr(5),i="comparative_"==t.substr(0,12);v.changeTrack(t,i)})}}}),!1}),$(l+" #list_line").hover(function(){$(l+" #list_line").css("background-color","#BBBBBB")},function(){$(l+" #list_line").css("background-color","#DDDDDD")}),$(l+" #add_bam").off("click"),$(l+" #add_bam").on("click",function(){var t=$("#files")[0].files;if(1!=t.length&&2!=t.length)return void alert('Please select a ".bw" file OR ".bam" and ".bai" files!');var i,e=t[0],s=t[1];if(".bam"==e.name.substr(-4)&&".bai"==s.name.substr(-4)){i="bam";var o=e;e=s,s=o}else if(".bai"==e.name.substr(-4)&&".bam"==s.name.substr(-4))i="bam";else{if(".bw"!=e.name.substr(-3))return void alert('Please select a ".bw" file OR ".bam" and ".bai" files!');i="bw"}for(var n=!1,a=1;!n;){var r="your_"+i;1!=a&&(r+="_"+a);var h="bam"==i?new WgBam2(r,r,[s,e],{localFlg:!0,seqUrl:null}):new WgBigWig2(r,"#008844",r,e,{localFlg:!0});try{v.addCreateParts(h),v.changeTrack(r),n=!0}catch(l){a++,n=!1}}}),!1}),$(l+" #down_menu #setting").click(function(){$(l+" #movable_title").html("Browser settings");var e="";return e+='<div style="white-space: nowrap">',e+='W<input id="viewer_width" size="4" maxlength="4" type="text">',e+='x H<input id="viewer_height" size="4" maxlength="4" type="text">',e+='<input id="change_size" class="tool_button" value="Change size" type="button">',e+="</div>",$(l+" #content").html(e),$(l+" #viewer_width").val(v.width),$(l+" #viewer_height").val(v.height),$(l+" #movable_menu").css({top:t,left:i}).fadeIn(100),$(l+" #down_menu").css("visibility","hidden"),$(l+" #change_size").off("click"),$(l+" #change_size").on("click",function(){var t=Math.floor($("div"+o+" #viewer_width").val()),i=Math.floor($("div"+o+" #viewer_height").val());return isNaN(i)&&(i=200),200>t&&(t=200),200>i&&(i=200),t>2e3&&(t=2e3),i>2e3&&(i=2e3),v.setCookie("viewerWidth",t),v.setCookie("viewerHeight",i),v.setViewerSize(t,i),!1}),!1}),$(l+" #movable_close").click(function(){return $(l+" #movable_menu").fadeOut(100),!1}),$(l+" #movable_title").mousedown(function(e){var s=e.pageX,o=e.pageY;return $(document).on("mousemove.movable_menu",function(e){return t+=e.pageX-s,i+=e.pageY-o,$(l+" #movable_menu").css({top:i,left:t}),s=e.pageX,o=e.pageY,!1}).one("mouseup",function(){$(document).off("mousemove.movable_menu")}),!1}),$(document).on({click:function(){$(l+" #down_menu").css("visibility","hidden"),$(document).unbind("click")}})}else $(l+" #down_menu").css("visibility","hidden");return!1})}};GenomeViewer.prototype={paint:function(t,i){if(this.start>this.end)throw Error("invalid genome position.");if(void 0!==this.genome[this.chr]&&(this.option.showChromFlg&&this.ochr.paint(this.chr,this.start,this.end,this.strand),this.setMHeight(),this.mHeight>MAX_HEIGHT&&(console.log("too large"),this.mHeight=MAX_HEIGHT),void 0!==this.mCanvas)){var e=3*this.width;this.mCanvas.height=this.mHeight,this.mCc.clearRect(0,0,e,this.mHeight);var s=this.cCanvas.height+this.lCanvas.height;this.scrollY+this.height-s>this.mCanvas.height&&(this.scrollY=this.mCanvas.height-this.height+s),this.scrollY<0&&(this.scrollY=0),"info"==this.mode&&(this.infoData=this.getPopupInfoData());var o=this.end-this.start+1,n=this.start-o,a=this.end+o;this.option.showScaleFlg&&(this.lCc.clearRect(0,0,e,this.lCanvas.height),this.oscale.paint(0,e,this.chr,n,a,this.strand)),void 0!==this.option.jsonMax&&(this.attachNowtime(e,this.chr,n,a),this.cutOldJson());for(var r={},h={},l=0,d=0;d<this.viewerParts.length;d++){var c=this.viewerParts[d].repaint(l,e,this.chr,n,a,this.strand,this.option.bgVlineFlg,this.mode),v=this.viewerParts[d].getKindName();if(c.length&&void 0===this.errorParts[v]&&(r[v]=c,h[v]=this.viewerParts[d]),void 0!==t&&v in t[1]&&(this.errorParts[v]=t[0]),void 0!==this.errorParts[v]){this.mCc.font="10px 'Helvetica'";var g=this.mCc.measureText(this.errorParts[v]).width;this.mCc.fillStyle="#FF0000",this.mCc.fillText(this.errorParts[v],1.5*this.width-g/2,l+10)}l+=this.viewerParts[d].getHeight()}if(this.mHeight==MAX_HEIGHT){this.mCc.fillStyle="#CCCCCC",this.mCc.fillRect(0,this.mHeight-30,e,30);var p="Some of data could not show because of the too large image height.";this.mCc.font="10px 'Helvetica'",this.mCc.fillStyle="#FF0000";var g=this.mCc.measureText(p).width;this.mCc.fillText(p,1.5*this.width-g/2,this.mHeight-10)}if(this.itemShowFlg){
var u=this.iCanvas.width;this.iCanvas.height=this.mHeight,this.iCc.clearRect(0,0,u,this.mHeight),this.option.itemTrans||(this.iCc.fillStyle="#AAAAAA",this.iCc.fillRect(u-3,0,3,this.mHeight),this.iCc.fillRect(0,0,3,this.mHeight));for(var f=0,d=0;d<this.viewerParts.length;d++){var m=this.viewerParts[d].getHeight();if(0!=m){var w=this.viewerParts[d].getName(),b=this.viewerParts[d].getItemDispName(),_=this.viewerParts[d].getAboidingLeftPanelSpace();if(this.iCc.fillStyle=this.viewerParts[d].getPannelBgcolor(),!this.option.itemTrans){this.iCc.globalAlpha=.95,this.iCc.fillRect(3,f,u-6,m),this.iCc.globalAlpha=1,this.iCc.font="12px 'NSimSun'";var P=Math.floor((this.iCanvas.width-10-_)/6);if(P>1){var C=Math.floor((b.length+(P-1))/P);if("separator"!=w){this.iCc.fillStyle=this.viewerParts[d].getLabelCol();for(var y=0;C>y;y++){var $=f+m/2+3+10*(y-(C-1)/2);this.iCc.fillText(b.substr(y*P,P),5,$)}}}}void 0!==this.viewerParts[d].paintVScale&&this.viewerParts[d].paintVScale(this.iCc,this.iCanvas.width),f+=m}}}this.paintRender(0);var k,S,F=[];for(var I in r)if("err"!=r[I])for(var y=0;y<r[I].length;y++){var x=r[I][y],D=Math.floor(Math.LOG10E*Math.log((this.end-this.start+1)/this.width));0>D&&(D=0);var M=Math.pow(10,D)*POW_REG,j=Math.floor((this.genome[this.chr][1]-1)/M);if(x>j){D in this.json||(this.json[D]={});var T=this.chr+"|"+x;T in this.json[D]||(this.json[D][T]={}),this.json[D][T][I]=[]}else this.loadingData[D+"|"+this.chr+"|"+x+"|"+I]||(void 0===k?(k=x,S=x):(k>x&&(k=x),x>S&&(S=x)),F.push(I))}if(void 0!==k){for(var O={},A={},d=0;d<F.length;d++){var I=F[d];"sequence"==I?this.end-this.start+1<this.width&&(O[I]=h[I]):I in A||(O[I]=h[I],A[I]=1)}var D=Math.floor(Math.LOG10E*Math.log((this.end-this.start+1)/this.width));0>D&&(D=0),this.accessData(this.chr,k,S,D,O)}if(void 0!==this.option.moveCallback){var B="-"==this.strand||"-1"==this.strand?"-":"+",E={chr:this.chr,start:this.start,end:this.end,strand:B};this.option.moveCallback(E,i)}}},paintRender:function(t,i,e,s){if(void 0!==this.genome[this.chr]){if(this.cc.clearRect(0,0,this.width,this.height),this.option.showChromFlg){this.cc.drawImage(this.cCanvas,0,0);var o=(this.width-1)*(this.start-1)/(this.genome[this.chr][1]-1),n=(this.width-1)*(this.end-1)/(this.genome[this.chr][1]-1),a=(this.cCanvas.height-this.chrBaseY-this.relYSpace)/2+this.chrBaseY-6,r=(this.cCanvas.height-this.chrBaseY-this.relYSpace)/2+this.chrBaseY+6;this.cc.strokeStyle="#FF0000",this.cc.strokeRect(o,a,n-o+1,r-a+1)}this.option.showScaleFlg&&this.cc.drawImage(this.lCanvas,t-this.width,this.cCanvas.height);var h=this.cCanvas.height+this.lCanvas.height;if(this.mCanvas.height-this.scrollY>0&&(this.cc.drawImage(this.mCanvas,0,this.scrollY,this.mCanvas.width,this.mCanvas.height-this.scrollY,t-this.width,h,this.mCanvas.width,this.mCanvas.height-this.scrollY),this.itemShowFlg))if("pedge"==i){this.cc.fillStyle="#EEEEEE",this.cc.globalAlpha=.8;var a=this.height-h;this.mHeight<a&&(a=this.mHeight),this.cc.fillRect(0,h,e,a),this.cc.globalAlpha=1,this.cc.strokeStyle="#880000",this.cc.strokeRect(e-2,h,1,a)}else this.cc.drawImage(this.iCanvas,0,this.scrollY,this.iCanvas.width,this.iCanvas.height-this.scrollY,0,h,this.iCanvas.width,this.iCanvas.height-this.scrollY);if("scale"==i)if(this.cc.strokeStyle="#880000",void 0!==s){if(e>s){var l=s;s=e,e=l}this.cc.strokeRect(e,this.cCanvas.height,s-e,this.height-this.cCanvas.height)}else this.cc.strokeRect(e,this.cCanvas.height,1,this.height-this.cCanvas.height);else if("chromosome"==i){if(this.cc.strokeStyle="#880000",void 0!==s){if(e>s){var l=s;s=e,e=l}var d=(this.cCanvas.height-this.chrBaseY)/2+this.chrBaseY-15;this.cc.strokeRect(e,d,s-e,30)}}else if("panel"==i){this.cc.strokeStyle="#880000";var c=this.getTargetObjListToSeparator(e,!0);if(0!=c.length){for(var v=h+c[0].y-this.scrollY,g=0,p=0;p<c.length;p++)g+=c[p].getHeight();var u=v+g-1;if(h>v&&(v=h),u>=v&&this.cc.strokeRect(0,v,this.iCanvas.width,u-v+1),void 0!==s)if("separator"==c[0].getName()){var f=this.getTargetObj(s);if(void 0!==f){var m=h+f.y-this.scrollY;m!=v&&this.cc.strokeRect(0,m,this.width,1)}}else{var w=this.getTargetObjListToSeparator(s);if(0!=w.length){var g=0;if(c[0].y<w[0].y)for(var p=0;p<w.length;p++)g+=w[p].getHeight();var m=h+w[0].y+g-this.scrollY-1;m!=u&&m+1!=v&&this.cc.strokeRect(0,m,this.width,1)}}}}if(this.height-h<this.mCanvas.height)if(this.option.autoSizingFlg)this.setViewerSize(this.width,this.mCanvas.height+h+1);else{this.cc.drawImage(this.sCanvas,this.width-this.sCanvas.width,h);var b=this.width-this.sCanvas.width/2-5,_=b+10,P=this.scrollHeight;this.height-h<this.mCanvas.height&&(P=this.scrollHeight*(this.height-h)/this.mCanvas.height);var C=this.scrollHeight*this.scrollY/this.mCanvas.height,y=C+h+20,$=y+P;this.cc.fillStyle="#888899",this.cc.fillRect(b,y,_-b+1,$-y+1)}else this.option.autoSizingFlg&&this.height-h>this.mCanvas.height+10&&this.setViewerSize(this.width,this.mCanvas.height+h+1)}},setMHeight:function(){for(var t=0,i=0;i<this.viewerParts.length;i++){var e=this.end-this.start+1,s=""==this.strand?"+":this.strand,o=3*this.width,n=this.start-e,a=this.end+e,r=Math.floor(Math.LOG10E*Math.log((a-n+1)/o)),h=this.viewerParts[i];if(void 0!==h.imgCaching&&(void 0===h.imgCaching.applyMinPow||h.imgCaching.applyMinPow<=r))h.setHeightForCaching(o,this.chr,n,a,s);else if(void 0!==h.setHeight2){var l=h.getJsonParsedDataStatus(o,this.chr,n,a);h.setHeight2(l[0],o,this.chr,n,a,s)}else h.setHeight(o,this.chr,n,a,s);t+=h.getHeight()}this.mHeight=t},setGenomePosition:function(t,i,e,s,o){if(this.chr!=t||this.start!=i||this.end!=e||this.strand!=s){if(i>e){var n=i;i=e,e=n,s="-"==s?"+":"-"}this.chr=t,this.start=i,this.end=e,this.strand=s;var a=t+":"+Number(Math.floor(i)).toLocaleString()+"-"+Number(Math.floor(e)).toLocaleString();"-"!=s&&"+"!=s||(a+=":"+s),this.option.locationBarFlg&&!o&&(window.location.href="#"+this.option.linkAdd+a),$("div"+this.divId+" #"+this.option.toolbarId+" #genome_position").val(a),this.paint()}},setPosition:function(t,i){if(t>i){var e=t;t=i,i=e}this.start=t,this.end=i},accessData:function(t,i,e,s,o){0>i&&(i=0),0>e&&(e=0);for(var n=i;e>=n;n++)for(var a in o)this.loadingData[s+"|"+t+"|"+n+"|"+a]=!0;for(var a in o){var r={};if(r[a]=o[a],this.option.uriDirFlg)for(var h=i;e>=h;h++)this.accessDataEach(t,h,h,s,r);else this.accessDataEach(t,i,e,s,r)}},accessDataEach:function(t,i,e,s,o){var n=this;this.accNo++;var a={success:function(a){var r=!1;if(n.option.uriDirFlg){s in n.json||(n.json[s]={});var h=t+"|"+i;h in n.json[s]||(n.json[s][h]={});for(var l in a)l in n.json[s][h]?console.log("Warning: data exists."):(n.json[s][h][l]=a[l],a[l][0]&&void 0!==a[l][0].base64_img&&(!function(){var t=a[l][0],i=new Image;i.onload=function(){t._img=this,"body"!=n.mousedownType&&n.paint()},i.src="data:image/png;base64,"+a[l][0].base64_img}(),r=!0))}else for(var d in a){d in n.json||(n.json[d]=[]);for(var h in a[d]){h in n.json[d]||(n.json[d][h]={});for(var l in a[d][h])l in n.json[d][h]?console.log("Warning: data exists."):(n.json[d][h][l]=a[d][h][l],a[d][h][l][0]&&void 0!==a[d][h][l][0].base64_img&&(!function(){var t=a[d][h][l][0],i=new Image;i.onload=function(){t._img=this,"body"!=n.mousedownType&&n.paint()},i.src="data:image/png;base64,"+a[d][h][l][0].base64_img}(),r=!0))}}if("body"!=n.mousedownType&&(n.accNo-1)%Math.floor((n.viewerParts.length+9)/10)==0)if(void 0===n.option.commonData)r||n.paint();else for(var c=n.option.commonData.getCallBackObj(),v=0;v<c.length;v++)c[v].paint();for(var h=i;e>=h;h++)for(var g in o)n.option.uriDirFlg&&void 0===a[g]?alert("Error: Json format is invalid ("+g+") "):n.loadingData[s+"|"+t+"|"+h+"|"+g]=!1},error:function(t,i,e){var s="object"==typeof t&&t.status?t.status:"Unknown error",a="object"==typeof e&&e.message?e.message:"no message";console.log("Error occur:"+s+","+i+","+a);var r={};for(var h in o)r[h]=1;var l=new Array(2);l[0]="Error: Data access failed",l[1]=r,n.paint(l)},complete:function(){n.accNo--}};for(var r in o)if(void 0!==o[r].accessObj)o[r].accessObj(t,parseInt(i),parseInt(e),parseInt(s),a);else{var h=void 0===this.urlSet.additionalParam?"":"&"+this.urlSet.additionalParam,l=void 0!==o[r].jsonUrl?o[r].jsonUrl:this.urlSet.json;l+=this.option.uriDirFlg?"/"+s+"/"+t+"/"+i+"/"+r+"/?"+h:"?bin_region="+t+":"+i+"-"+e+"&pow="+s+"&kinds="+r+h;var d=a;d.url=l,d.xhrFields={withCredentials:this.option.withCredentials},d.dataType="json",$.ajax(d)}},initViewer:function(){var t=this,i=this.divId;if(this.canvas=$("div"+i+" #"+this.option.viewerId+" #main_viewer")[0],void 0===this.canvas)return!1;this.cc=this.canvas.getContext("2d");var e=$("div"+i+" #"+this.option.viewerId+" #main_viewer")[0].getBoundingClientRect();this.x=e.left+$(window).scrollLeft(),this.y=e.top+$(window).scrollTop(),this.cCanvas=document.createElement("canvas"),this.option.showChromFlg?(this.cCanvas.width=this.width,this.cCanvas.height=75,this.cCc=this.cCanvas.getContext("2d"),this.ochr.initData(this.cCc,this.width,this.cCanvas.height)):this.cCanvas.height=0,this.lCanvas=document.createElement("canvas"),this.option.showScaleFlg?(this.lCanvas.width=3*this.width,this.lCanvas.height=25,this.lCc=this.lCanvas.getContext("2d"),this.oscale=new WgScale(this.lCanvas.height,this.genome),this.oscale.setImgJson(this.lCc)):this.lCanvas.height=0,this.sCanvas=document.createElement("canvas"),this.sCanvas.width=20;var s=this.option.showChromFlg?this.cCanvas.height:0;this.sCanvas.height=this.height-s-this.lCanvas.height,this.sCc=this.sCanvas.getContext("2d"),this.sCc.globalAlpha=.5,this.sCc.fillStyle="#ffffff",this.sCc.fillRect(0,0,this.sCanvas.width,this.sCanvas.height),this.sCc.fillStyle="#9999ff",this.sCc.fillRect(1,1,this.sCanvas.width-2,this.sCanvas.height-2),this.sCc.globalAlpha=.5,this.sCc.fillStyle="#ffffff",this.scrollHeight=this.sCanvas.height-10-20,this.sCc.fillRect(this.sCanvas.width/2-3,20,6,this.scrollHeight+1),this.sCc.globalAlpha=1,this.sCc.fillRect(this.sCanvas.width/2-6,18,12,2),this.sCc.fillRect(this.sCanvas.width/2-6,21+this.scrollHeight,12,2),this.mCanvas=document.createElement("canvas"),this.mCanvas.width=3*this.width,this.mCanvas.height=this.height,this.mCc=this.mCanvas.getContext("2d"),this.mHeight=null,this.iCanvas=document.createElement("canvas"),this.iCanvas.width=100,this.iCanvas.height=this.height,this.iCc=this.iCanvas.getContext("2d");for(var o=0;o<this.viewerPartsAll.length;o++)this.viewerPartsAll[o].setImgJson(this.mCc,this.json,this.genome);this.mousedownType="",$("div"+i+" #"+this.option.toolbarId+" #viewer_width").val(this.width),$("div"+i+" #"+this.option.toolbarId+" #viewer_height").val(this.height),$("div"+i+" #"+this.option.viewerId+" #main_viewer").bind("contextmenu",function(e){if("nav"==t.mode||"info"==t.mode){var s=t.getTargetObj(this.startY);if(void 0!==s){var o=this.startY;$("div"+i+" #right_pop").css("visibility","hidden");var n=s.getMenuPopup();if(t.option.itemSwitchFlg&&(n+="separator"==s.getName()?'<a href="#" class="del">Delete separator</a>':'<hr><a href="#" class="del">Delete this track</a>'),""==n)return!1;if(t.panelPopup.poppedFlg=!0,$("div"+i+" #right_pop").html(n),void 0!==s.menuPopAction)if(t.settingSyncFlg)for(var a=t.viewerParts,r=0;r<a.length;r++)"separator"!=a[r].getName()&&a[r].__proto__===s.__proto__&&a[r].menuPopAction(t);else s.menuPopAction(t);$("div"+i+" #right_pop").css("left",e.pageX+2).css("top",e.pageY+2).css("border","solid 1px").css("background-color","#FFFFFF").css("color","#000000").css("border-radius","5px").css("padding","5px").css("box-shadow","5px 5px 5px 0px rgba(200,200,200,0.8)").css("visibility","visible"),$("input[name='show_model']").change(function(){s.showModelFlg=$("input[name='show_model']:checked").val(),$("div"+i+" #right_pop").css("visibility","hidden"),t.paint()}),$("input[name='const_width']").change(function(){s.constWidthFlg=$("input[name='const_width']:checked").val(),$("div"+i+" #right_pop").css("visibility","hidden"),t.paint()}),$("input[name='show_type']").change(function(){if(t.settingSyncFlg)for(var e=t.viewerParts,o=0;o<e.length;o++)"separator"!=e[o].getName()&&e[o].__proto__===s.__proto__&&(e[o].showType=$("input[name='show_type']:checked").val(),void 0!==e[o].showTypeChangeAction&&e[o].showTypeChangeAction());else s.showType=$("input[name='show_type']:checked").val(),void 0!==s.showTypeChangeAction&&s.showTypeChangeAction();$("div"+i+" #right_pop").css("visibility","hidden"),t.paint()}),$("div"+i+" a.del").click(function(){return t.deleteTargetObj(o),$("div"+i+" #right_pop").css("visibility","hidden"),t.paint(),!1}),$("div"+i+" a.det").click(function(){$("div"+i+" #right_pop").css("visibility","hidden");var e,o;if(""!=s.getMenuDetail()){var n="",a=s.getMenuDetail();"string"==typeof a?(e=500,o=600,n=a):(e=a[1][0],o=a[1][1],n=a[0]),$("div"+t.divId+" div#modal div.container").html(n),$("div"+t.divId+" div#modal div.container #apply_button").click(function(){if(t.settingSyncFlg)for(var i=t.viewerParts,e=0;e<i.length;e++)"separator"!=i[e].getName()&&i[e].__proto__===s.__proto__&&i[e].setViewDetail(t.divId);else s.setViewDetail(t.divId);return t.displayModal(!1),t.paint(),!1}),$("div"+t.divId+" div#modal div.container #cancel_button").click(function(){return t.displayModal(!1),!1}),void 0!==s.menuDetailAction&&s.menuDetailAction(t)}return t.displayModal(!0,[e,o]),!1}),$("div"+i+" a.help").click(function(){$("div"+i+" #right_pop").css("visibility","hidden");var e,o;if(""!=s.getHelpData()){var n=s.getHelpData();e=n[1][0],o=n[1][1],$("div"+t.divId+" div#modal div.container").html(n[0]),$("div"+t.divId+" div#modal div.container #ok_button").click(function(){return t.displayModal(!1),!1})}return t.displayModal(!0,[e,o]),!1})}}return!1}),$("div"+i+" #"+this.option.viewerId+" #main_viewer").on("mouseover",function(e){e.preventDefault();var s=$("div"+i+" #"+t.option.viewerId+" #main_viewer")[0].getBoundingClientRect();t.x=s.left+$(window).scrollLeft(),t.y=s.top+$(window).scrollTop(),this.scaleBarFlg=!1,"body"==t.mousedownType&&t.paint(),"pedge"==t.mousedownType&&t.paint(),t.mousedownType=""}),$("div"+i+" #"+this.option.viewerId+" #main_viewer").on("dblclick",function(i){if(void 0!==t.genome[t.chr]&&(i.preventDefault(),"nav"==t.mode&&t.option.dblclickSizingFlg)){var e=(i.pageX-t.x)/t.width,s="-"==t.strand?e*t.start+(1-e)*t.end:e*t.end+(1-e)*t.start,o=Math.floor((t.start+s+1)/2),n=Math.floor((t.end+s+1)/2);1>o&&(o=1),n>t.genome[t.chr][1]&&(n=t.genome[t.chr][1]),t.setGenomePosition(t.chr,o,n,t.strand)}}),$("div"+i+" #"+this.option.viewerId+" #main_viewer").on("mousedown",function(e){e.preventDefault(),$("div"+i+" #right_pop").css("visibility","hidden"),this.startX=e.pageX,this.startY=e.pageY;var s=this.startY-t.y,o=this.startX-t.x,n=t.cCanvas.height+t.lCanvas.height;if("nav"==t.mode){if(t.itemShowFlg&&t.iCanvas.width-5<=o&&o<=t.iCanvas.width&&s>n)$(this).css("cursor","-moz-grabbing").css("cursor","-webkit-grabbing"),console.log("pedge"),t.mousedownType="pedge",t.paintRender(0,"pedge",t.iCanvas.width);else if(t.itemShowFlg&&o<=t.iCanvas.width&&s>n){$(this).css("cursor","-moz-grabbing").css("cursor","-webkit-grabbing"),console.log("panel"),t.mousedownType="panel";var a=t.getTargetObj(this.startY);void 0!==a&&t.paintRender(0,"panel",this.startY)}else t.width-t.sCanvas.width<o&&s>n&&t.height-n<t.mCanvas.height?($(this).css("cursor","-moz-grabbing").css("cursor","-webkit-grabbing"),t.mousedownType="scroll"):s<t.cCanvas.height&&t.option.chromSizingFlg?(console.log("chromosome"),t.mousedownType="chromosome",this.xPosStart=o):n>s&&t.option.scaleSizingFlg?(console.log("scale"),t.mousedownType="scale",this.xPosStart=o):($(this).css("cursor","-moz-grabbing").css("cursor","-webkit-grabbing"),t.mousedownType="body");this.renderStartX=e.pageX}}),$("div"+i+" #"+this.option.viewerId+" #main_viewer").on("mouseup",function(e){if(void 0!==t.genome[t.chr]){e.preventDefault();var s=e.pageX-t.x,o=e.pageY-t.y;if("nav"==t.mode)if($(this).css("cursor","pointer").css("cursor","-moz-grab").css("cursor","-webkit-grab"),t.itemShowFlg&&"panel"==t.mousedownType){var n,a,r=t.getTargetObjListToSeparator(this.startY,!0),h=t.getTargetObjListToSeparator(e.pageY),l=t.getTargetObj(e.pageY);if(0!=r.length&&(n=r[0].y),0!=h.length&&(toObjFirstY=h[0].y,a=h[h.length-1].y),0!=r.length&&0!=h.length){var d="separator"==r[0].getName();if(d&&n!=l.y&&n+r[0].getHeight()!=l.y||!d&&n!=h[0].y){var c,v;if(d)for(var g=0;g<t.viewerParts.length;g++){var p=t.viewerParts[g].y;p==n&&(c=g),p==l.y&&(v=g-1)}else for(var g=0;g<t.viewerParts.length;g++){var p=t.viewerParts[g].y;p==n&&(c=g),void 0===c&&p==toObjFirstY&&(v=g-1),void 0!==c&&p==a&&(v=g)}var u=new Array;if(v>c){for(var g=0;c>g;g++)u.push(t.viewerParts[g]);for(var g=c+r.length;v+1>g;g++)u.push(t.viewerParts[g]);for(var g=c;g<c+r.length;g++)u.push(t.viewerParts[g]);for(var g=v+1;g<t.viewerParts.length;g++)u.push(t.viewerParts[g])}else{for(var g=0;v+1>g;g++)u.push(t.viewerParts[g]);for(var g=c;g<c+r.length;g++)u.push(t.viewerParts[g]);for(var g=v+1;c>g;g++)u.push(t.viewerParts[g]);for(var g=c+r.length;g<t.viewerParts.length;g++)u.push(t.viewerParts[g])}t.viewerParts=u,t.paint(),t.mousedownType=""}else t.mousedownType="",t.paintRender(0)}else t.mousedownType="",t.paintRender(0)}else if("chromosome"==t.mousedownType&&s!=this.xPosStart&&o<t.cCanvas.height){var f=s<this.xPosStart?s:this.xPosStart,m=s>this.xPosStart?s:this.xPosStart,w=t.genome[t.chr][1],b=(w-1)/(t.width-1)*f+1,_=(w-1)/(t.width-1)*m+1;t.mousedownType="",t.setGenomePosition(t.chr,b,_,t.strand)}else if("scale"==t.mousedownType&&this.scaleBarFlg&&s!=this.xPosStart){var f=s<this.xPosStart?s:this.xPosStart,m=s>this.xPosStart?s:this.xPosStart,b="-"==t.strand?(t.start-t.end-1)/(t.width-1)*m+t.end+.5:(t.end-t.start+1)/(t.width-1)*f+t.start-.5,_="-"==t.strand?(t.start-t.end-1)/(t.width-1)*f+t.end+.5:(t.end-t.start+1)/(t.width-1)*m+t.start-.5;this.scaleBarFlg=!1,t.mousedownType="",t.setGenomePosition(t.chr,b,_,t.strand)}else{if(this.scaleBarFlg=!1,"scroll"!=t.mousedownType&&this.renderStartX!=e.pageX){if("pedge"==t.mousedownType){var P=Math.floor(s);20>P&&(P=20),P>t.width-50&&(P=t.width-50),t.iCanvas.width=P+3}t.paint(void 0,!0)}else"pedge"==t.mousedownType&&t.paintRender(0);t.mousedownType="";var b=t.start,_=t.end;1>b&&(_=_-b+1,b=1),_>t.genome[t.chr][1]&&(b=t.genome[t.chr][1]-(_-b),1>b&&(b=1),_=t.genome[t.chr][1]);var C=t.chr+":"+Math.floor(b)+"-"+Math.floor(_),y=t.chr+":"+Number(Math.floor(b)).toLocaleString()+"-"+Number(Math.floor(_)).toLocaleString();"-"!=t.strand&&"+"!=t.strand||(C+=":"+t.strand,y+=":"+t.strand),t.option.locationBarFlg&&(window.location.href="#"+t.option.linkAdd+C),$("div"+i+" #"+t.option.toolbarId+" #genome_position").val(y)}else{var k=o-t.cCanvas.height-t.lCanvas.height+t.scrollY,S=s;if(k>=t.scrollY){var F=[];for(yParts in t.infoData){var I=yParts.split(",");if(I[0]<=k&&k<=I[1])for(yPartsIn in t.infoData[yParts]){var x=yPartsIn.split(",");if(x[0]<=k&&k<=x[1])for(xParts in t.infoData[yParts][yPartsIn]){var D=xParts.split(",");D[0]<=S&&S<=D[1]&&F.push([yParts,yPartsIn,xParts])}}}var M=F.length;if(M){this.targetNo=void 0===this.targetNo?0:this.targetNo+1,this.targetNo>=M&&(this.targetNo=0);var j=F[this.targetNo],T=t.infoData[j[0]][j[1]][j[2]];if(void 0!==T.html){var O=T.html;$("div"+i+" #right_pop").css("visibility","hidden"),$("div"+i+" #right_pop").html(O),$("div"+i+" #right_pop").css("left",e.pageX+2).css("top",e.pageY+2).css("border","solid 1px").css("background-color","#FFFFFF").css("color","#000000").css("visibility","visible"),$(this).css("cursor","pointer")}if(void 0!==T.action){var b="-"==t.strand?(t.start-t.end-1)/(t.width-1)*(s+.5)+t.end+1:(t.end-t.start+1)/(t.width-1)*(s-.5)+t.start,_="-"==t.strand?(t.start-t.end-1)/(t.width-1)*(s-.5)+t.end+1:(t.end-t.start+1)/(t.width-1)*(s+.5)+t.start,A={chr:t.chr,start:b,end:_,strand:t.strand};T.action(A,T.actionParam)}}}}}}),$("div"+i+" #"+this.option.viewerId+" #main_viewer").on("mousemove",function(e){e.preventDefault();var s=e.pageY-t.y,o=e.pageX-t.x,n=t.cCanvas.height+t.lCanvas.height;if(t.itemShowFlg&&"panel"!=t.mousedownType&&o<=t.iCanvas.width&&s>n){var a=t.getTargetObj(e.pageY);if(void 0!==a){var r=a.getName();"separator"==r||t.panelPopup.poppedFlg?t.panelPopup.poppedFlg&&"hidden"==$("div"+i+" #right_pop").css("visibility")&&(t.panelPopup.poppedFlg=!1):t.panelPopup.targetObj?t.panelPopup.targetObj.getName()!=a.getName()&&(t.panelPopup.targetObj=a,t.panelPopup.firedFlg&&t.showLabelPopup()):(t.panelPopup.targetObj=a,t.panelPopup.firedFlg=!1,t.panelPopup.timerId=setTimeout(function(){t.showLabelPopup()},500))}}else t.panelPopup.targetObj&&(t.panelPopup.targetObj=null,t.panelPopup.firedFlg=!1,clearTimeout(t.panelPopup.timerId),t.panelPopup.poppedFlg?t.panelPopup.poppedFlg=!1:$("div"+i+" #right_pop").css("visibility","hidden"));if("nav"==t.mode){if(t.itemShowFlg&&"pedge"==t.mousedownType)n>=s?(t.mousedownType="",t.paint()):o>=20&&o<=t.width-50&&t.paintRender(0,"pedge",Math.floor(o+3));else if(t.itemShowFlg&&"panel"==t.mousedownType&&s>n)t.viewerParts.length>15?$(this).css("cursor","wait"):$(this).css("cursor","-moz-grabbing").css("cursor","-webkit-grabbing"),t.paintRender(0,"panel",this.startY,e.pageY);else if(s<t.cCanvas.height)t.option.chromSizingFlg&&($(this).css("cursor","crosshair"),"chromosome"==t.mousedownType&&t.paintRender(0,"chromosome",o,this.xPosStart));else if(s<t.cCanvas.height+t.lCanvas.height&&t.option.scaleSizingFlg)$(this).css("cursor","crosshair"),this.scaleBarFlg=!0,"scale"==t.mousedownType?t.paintRender(0,"scale",o,this.xPosStart):t.paintRender(0,"scale",o);else if("body"==t.mousedownType){t.viewerParts.length>15?$(this).css("cursor","wait"):$(this).css("cursor","-moz-grabbing").css("cursor","-webkit-grabbing");var h=(this.startX-e.pageX)*(t.end-t.start+1)/t.width,l="-"==t.strand?-1:1;if(t.option.edgePreventFlg){t.start<1&&(t.end-=t.start-1,t.start=1);var d=t.genome[t.chr][1];t.end>d&&(t.start-=t.end-d,t.end=d)}t.setPosition(parseFloat(t.start)+l*h,parseFloat(t.end)+l*h),t.paintRender(e.pageX-this.renderStartX),this.startX=e.pageX}else if("scroll"==t.mousedownType){$(this).css("cursor","-moz-grabbing").css("cursor","-webkit-grabbing");var n=t.cCanvas.height+t.lCanvas.height;t.scrollY+=(e.pageY-this.startY)*t.mCanvas.height/t.scrollHeight,this.startY=e.pageY,t.scrollY+t.height-n>t.mCanvas.height&&(t.scrollY=t.mCanvas.height-t.height+n),t.scrollY<0&&(t.scrollY=0),t.paintRender(0)}else $(this).css("cursor","pointer").css("cursor","-moz-grab").css("cursor","-webkit-grab");this.scaleBarFlg&&(s<t.cCanvas.height||s>=t.cCanvas.height+t.lCanvas.height)&&(this.scaleBarFlg=!1,t.paintRender(0))}else{var c=s-t.cCanvas.height-t.lCanvas.height+t.scrollY,v=o,g=!1;if(c>=t.scrollY)for(yParts in t.infoData){var p=yParts.split(",");if(p[0]<=c&&c<=p[1])for(yPartsIn in t.infoData[yParts]){var u=yPartsIn.split(",");if(u[0]<=c&&c<=u[1])for(xParts in t.infoData[yParts][yPartsIn]){var f=xParts.split(",");if(f[0]<=v&&v<=f[1]){g=!0,$(this).css("cursor","pointer");var m=t.infoData[yParts][yPartsIn][xParts];if(void 0!==m.autoPopHtml){var w=m.autoPopHtml;$("div"+i+" #right_pop").css("visibility","hidden"),$("div"+i+" #right_pop").html(w),$("div"+i+" #right_pop").css("left",e.pageX+15).css("top",e.pageY+5).css("border","solid 1px").css("background-color","#FFFFFF").css("color","#000000").css("visibility","visible")}}}}}g||$(this).css("cursor","auto")}});var n="onwheel"in document?"wheel":"onmousewheel"in document?"mousewheel":"DOMMouseScroll";$("div"+i+" #"+this.option.viewerId+" #main_viewer").on(n,function(i){var e=t.cCanvas.height+t.lCanvas.height,s=i.originalEvent.wheelDelta?-i.originalEvent.wheelDelta/40:i.originalEvent.deltaY?i.originalEvent.deltaY:i.originalEvent.detail;if(t.mCanvas.height-t.height+e>0&&!t.option.autoSizingFlg&&(0!=t.scrollY||s>0)&&(t.scrollY!=t.mCanvas.height-t.height+e||0>s)&&"pedge"!=t.mousedownType){i.preventDefault();var o=t.scrollY;t.scrollY+=15*s,t.scrollY+t.height-e>t.mCanvas.height&&(t.scrollY=t.mCanvas.height-t.height+e),t.scrollY<0&&(t.scrollY=0);var n=t.scrollY-o;this.startY-=n,t.paintRender(0)}})},showLabelPopup:function(){if(void 0===this.panelPopup.targetObj||this.panelPopup.poppedFlg)return!1;var t=this.divId,i=this.cCanvas.height+this.lCanvas.height,e=this.panelPopup.targetObj.y+this.y+i-this.scrollY;e<this.y+i&&(e=this.y+i),$("div"+t+" #right_pop").css("visibility","hidden"),$("div"+t+" #right_pop").html(this.panelPopup.targetObj.getItemDetailName()),$("div"+t+" #right_pop").css("left",this.iCanvas.width+this.x).css("top",e).css("border","solid 1px").css("background-color","rgba(40,75,90,0.8)").css("color","#FFFFFF").css("border-radius","0px").css("padding","5px").css("box-shadow","5px 5px 5px 0px rgba(200,200,200,0.8)").css("visibility","visible"),this.panelPopup.firedFlg=!0},attachNowtime:function(t,i,e,s){this.json;var o=Math.floor(Math.LOG10E*Math.log((s-e+1)/t));0>o&&(o=0);for(var n=Math.pow(10,o)*POW_REG,a=Math.floor((e-1)/n),r=Math.floor((s-1)/n),h=Math.floor((this.genome[i][1]-1)/n),l=a;r>=l;l++)l>=0&&h>=l&&this.json[o]&&this.json[o][i+"|"+l]&&(this.json[o][i+"|"+l]._now=Date.now())},cutOldJson:function(){var t=[];for(var i in this.json)for(var e in this.json[i])void 0!==this.json[i][e]._now&&t.push(this.json[i][e]._now);var s=this.option.jsonMax;if(t.length>s){t.sort(function(t,i){return t>i?-1:i>t?1:0});var o=t[s];for(var i in this.json)for(var e in this.json[i])void 0!==this.json[i][e]._now&&this.json[i][e]._now<o&&(delete this.json[i][e],console.log("deleted:"+i+", "+e))}},setViewerSize:function(t,i){this.width=t,this.height=i,$("div"+this.divId+" #"+this.option.toolbarId).css("width",this.width+2*this.option.boderCss-2*this.toolBarCss.padding),$("div"+this.divId+" #"+this.option.viewerId+" #main_viewer").remove(),$("div"+this.divId+" #"+this.option.viewerId).append('<canvas id="main_viewer" width="'+this.width+'" height="'+this.height+'">Sorry. Unsupported browser</canvas>'),$("div"+this.divId+" #"+this.option.viewerId+" #main_viewer").css("border",this.option.boderCss+"px solid"),this.initViewer(),this.paint()},getTargetObj:function(t){for(var i,e=t-this.y,s=e-this.cCanvas.height-this.lCanvas.height,o=0;o<this.viewerParts.length;o++){var n=this.viewerParts[o].y,a=n+this.viewerParts[o].getHeight()-1;if(n<=s+this.scrollY&&s+this.scrollY<=a){i=this.viewerParts[o];break}}return i},getTargetObjListToSeparator:function(t,i){var e=t-this.y,s=e-this.cCanvas.height-this.lCanvas.height,o=[],n=!1;t:for(var a=0;a<this.viewerParts.length;a++)if(n){if(o.push(this.viewerParts[a]),"separator"==this.viewerParts[a].getName())break}else{o.push(this.viewerParts[a]);var r=this.viewerParts[a].y,h=r+this.viewerParts[a].getHeight()-1;if(r<=s+this.scrollY&&s+this.scrollY<=h){if("separator"==this.viewerParts[a].getName()){if(i){o=[this.viewerParts[a]];break}break t}n=!0}else"separator"==this.viewerParts[a].getName()&&(o=[])}return o},deleteTargetObj:function(t){for(var i,e=t-this.y,s=e-this.cCanvas.height-this.lCanvas.height,o=0;o<this.viewerParts.length;o++){var n=this.viewerParts[o].y,a=n+this.viewerParts[o].getHeight()-1;if(n<=s+this.scrollY&&s+this.scrollY<=a){i=o;break}}return void 0!==i&&this.deleteViwerParts(i),!0},getPopupInfoData:function(){for(var t={},i=0,e=0;e<this.viewerParts.length;e++){var s=this.viewerParts[e].getHeight(),o=i+s-1,n=this.viewerParts[e].getPopupData(i,this.width,this.chr,this.start,this.end,this.strand);void 0!==n&&(t[i+","+o]=n),i+=s}return t},deleteViwerParts:function(t){var i=this.viewerParts[t],e=i.getName();if(this.viewerParts.splice(t,1),"separator"!=e){var s=i.getButtonInfo(),o=s.color[0];if($("div"+this.divId+" #"+this.option.ibuttonId+" #"+e).css("background-color","#"+o),s.onOff&&$("div"+this.divId+" #"+this.option.ibuttonId+" #"+e).val("off"),void 0!==this.viewerParts[t]&&"separator"==this.viewerParts[t].getName()&&this.viewerParts.splice(t,1),""!=this.option.browserId&&this.getCookie(this.option.browserId+"|")){for(var n="",a=this.getCookie(this.option.browserId+"|").split("|"),r=!1,h=0;h<a.length;h++)r?r=!1:a[h]!=e?(""!=n&&(n+="|"),n+=a[h]):void 0!==a[h+1]&&"separator"==a[h+1]&&(r=!0);this.setCookie(this.option.browserId+"|",n)}}if(i.comparaFlg&&($("div"+this.divId+" #"+i.addDiv+"_compara").remove(),$("div"+this.divId+" #"+i.addDiv+"_newview").remove(),$("div"+this.divId+" #"+i.addDiv+"_bs")[0]&&$("div"+this.divId+" #"+i.addDiv+"_bs").html(""),i.setInitFlg(!0)),this.option.onTrackAction&&"separator"!=e){var l={status:"del",targetObj:i};this.option.onTrackAction(l,this)}},addViwerParts:function(t,i){for(var e,s=this.viewerPartsAll[t],o=s.getName(),n=0;n<this.viewerParts.length;n++)if(this.viewerParts[n].getName()==o){e=n;break}if(void 0===e){if(this.viewerParts.push(s),"separator"!=o){var a=s.getButtonInfo(),r=a.color[1];$("div"+this.divId+" #"+this.option.ibuttonId+" #"+o).css("background-color","#"+r),a.onOff&&$("div"+this.divId+" #"+this.option.ibuttonId+" #"+o).val("on")}if(i){var h=new WgSeparator(3,"#777777");h.setImgJson(this.mCc),this.viewerPartsAll.push(h),this.viewerParts.push(h)}if(""!=this.option.browserId){var l=this.getCookie(this.option.browserId+"|");""!=l&&(l+="|"),l+=o,i&&(l+="|separator"),this.setCookie(this.option.browserId+"|",l)}if(this.option.onTrackAction&&"separator"!=o){var d={status:"add",targetObj:s};this.option.onTrackAction(d,this)}}else this.deleteViwerParts(e)},showItemFromButtonClick:function(t){for(var i=new RegExp(t),e=[],s=0;s<this.viewerPartsAll.length;s++){var o=this.viewerPartsAll[s].getName(),n=this.viewerPartsAll[s].getItemDispName();if(n.match(i)&&"separator"!=n){for(var a=!1,r=0;r<this.viewerParts.length;r++)if(o==this.viewerParts[r].getName()){a=!0;break}a||e.push(s)}}for(var s=0;s<e.length;s++)this.addViwerParts(e[s],!0);return this.paint(),!1},hideItemFromButtonClick:function(t){for(var i=new RegExp(t),e=!0;e;){e=!1;for(var s=0;s<this.viewerParts.length;s++){var o=(this.viewerParts[s].getName(),this.viewerParts[s].getItemDispName());if(o.match(i)&&"separator"!=o){e=!0;break}}e&&this.deleteViwerParts(s)}return this.paint(),!1},changeTrack:function(t,i){for(var e,s=0;s<this.viewerPartsAll.length;s++)if(t==this.viewerPartsAll[s].getName()){e=s;break}var o=!i;void 0!==e&&this.addViwerParts(e,o),this.paint()},adjustCenter:function(){var t="div"+this.divId+" div#modal div.container",i=window.innerWidth?window.innerWidth:$(window).width(),e=window.innerHeight?window.innerHeight:$(window).height(),s=(e-$(t).height())/2,o=(i-$(t).width())/2;0>s&&(s=0),$(t).css({top:s+"px",left:o+"px"})},displayModal:function(t,i){t?(void 0===i&&(i=[500,600]),$("div"+this.divId+" div#modal div.container").css("width",i[0]).css("height",i[1]),$("div"+this.divId+" div#modal").fadeIn(250)):$("div"+this.divId+" div#modal").fadeOut(250),this.adjustCenter()},addCreateParts:function(t,i){var e=t.getName();if(this.isExistPartsId(e))throw new Error("Already existed PartsID: "+e);var s=this;if(t.setImgJson(this.mCc,this.json,this.genome),this.viewerPartsAll.push(t),i&&this.addViwerParts(this.viewerPartsAll.length-1,!0),!this.option.trackBtnHideFlg){var o="",n=t.getItemDispName(),a=t.getButtonInfo();if(a.onOff){var r=i?"on":"off";o+='<input class="track_button" type="button" id="'+e+'" value="'+r+'" />'}else o+='<input class="track_button" type="button" id="'+e+'" value="'+n+'" />';var h=i?a.color[1]:a.color[0];$("div"+this.divId+" #"+this.option.ibuttonId).append(o),$("div"+this.divId+" #"+this.option.ibuttonId+" #"+e).css("background-color","#"+h),$("div"+this.divId+" #"+this.option.ibuttonId+" #"+e).click(function(){for(var t=$(this).attr("id"),i=0;i<s.viewerPartsAll.length;i++)if(s.viewerPartsAll[i].getName()==t){var e=!s.viewerPartsAll[i].comparaFlg;s.addViwerParts(i,e);break}return s.paint(),!1})}i&&this.paint()},isExistPartsId:function(t){for(var i=0;i<this.viewerPartsAll.length;i++)if(t==this.viewerPartsAll[i].getName())return!0;return!1},coCov16:function(t){for(var i=0,e=0;e<t.length;e++){var s=t.charAt(e);"A"==s||"a"==s?s=10:"B"==s||"b"==s?s=11:"C"==s||"c"==s?s=12:"D"==s||"d"==s?s=13:"E"==s||"e"==s?s=14:"F"!=s&&"f"!=s||(s=15),i+=s*(e*Math.pow(16,t.length-(e+1)))}return i},getCookie:function(t){var i=document.cookie+";",e=i.indexOf(t+"=",0);if(-1!=e){var s=i.substring(e,i.length),o=s.indexOf("=",0)+1,n=s.indexOf(";",o);
return unescape(s.substring(o,n))}return""},setCookie:function(t,i){if(i=String(i),-1!=i.indexOf(";",0)||-1!=i.indexOf("=",0))return!1;var e=new Date;e.setTime(e.getTime()+1e10);var s=t+"="+escape(i)+"; ";return s+="expires="+e.toGMTString()+";",document.cookie=s,!0}};var WgRoot=function(){this.imgObj=this.ojson=this.y=this.height=this.chrSize=void 0};WgRoot.prototype={repaint:function(t,i,e,s,o,n,a,r){if("info"==r&&(this.imgObj.fillStyle="#F5F5F5",this.imgObj.fillRect(0,t,i-1,t+this.height-1)),""==n&&(n="+"),a){var h=t,l=h+this.height-1,d=Math.floor(100*(o-s+1)/i);0>=d&&(d=1);for(var c=Math.pow(10,Math.floor(Math.LOG10E*Math.log(d))),v=Math.floor(s/c)*c;(xc=(v-s+.5)*(i-1)/(o-s+1))<i;){var g=Math.floor(v/c);this.imgObj.fillStyle=g%10==0?"#CCCCCC":"#EEEEEE";var p="-"==n?i-1-xc:xc;this.imgObj.fillRect(p,h,1,l-h+1),v+=c}}var u=Math.floor(Math.LOG10E*Math.log((o-s+1)/i)),f=[];if(this.y=t,void 0!==this.imgCaching&&(void 0===this.imgCaching.applyMinPow||this.imgCaching.applyMinPow<=u))f=this.paintForCaching(t,i,e,s,o,n);else if(void 0!==this.paint2){var m=this.getJsonParsedData(t,i,e,s,o,n);this.paint2(m[0],t,i,e,s,o,n),f=m[1]}else f=this.paint(t,i,e,s,o,n);return f},paint:function(){var t=[];return t},paintForCaching:function(t,i,e,s,o,n){var a=this.getName(),r=this.getForCachingData(i,e,s,o,n),h=r[0],l=r[1],d=[],c=Math.floor(Math.LOG10E*Math.log((o-s+1)/i));0>c&&(c=0);for(var v=Math.pow(10,c)*POW_REG,g=Math.floor((s-1)/v),p=Math.floor((o-1)/v),u=Math.floor((this.chrSize[e][1]-1)/v),f=g;p>=f;f++)if(this.ojson[c]&&this.ojson[c][e+"|"+f]&&this.ojson[c][e+"|"+f][a]){var m=this.ojson[c][e+"|"+f][a],w=f*v+1,b=(f+1)*v,_=l,P="-"==n?0:1;if(void 0===m._img&&(m._img=[]),void 0===m._img[P]&&(m._img[P]={}),void 0===m._img[P]["w"+_]&&(m._img[P]["w"+_]={}),void 0===m._img[P]["w"+_][h]){var C=document.createElement("canvas");C.width=_,C.height=this.height;var y=C.getContext("2d"),$=this.imgObj;this.imgObj=y,void 0!==this.paint2?this.paint2([m],0,C.width,e,w,b,n):this.paint(0,C.width,e,w,b,n),this.imgObj=$,m._img[P]["w"+_][h]=C}var k=(w-s)*(i-1)/(o-s+1),S=(b-s+1)*(i-1)/(o-s+1);if(S>=0&&i-1>=k){var F,I,x,D;if(k>=0?(x=0,F=k):(x=_*(0-k)/(S-k+1),F=0),i-1>=S?(D=_-1,I=S):(D=_*(i-1-k)/(S-k+1),I=i-1),"-"==n){var M;x=_-x-1,D=_-D-1,M=x,x=D,D=M,F=i-F-1,I=i-I-1,M=F,F=I,I=M}this.imgObj.drawImage(m._img[P]["w"+_][h],x,0,D-x+1,m._img[P]["w"+_][h].height,F,t,I-F+1,m._img[P]["w"+_][h].height)}}else f>=0&&u>=f&&(d.push(f),this.paintLoading(t,i,s,o,n,f));return d},getForCachingData:function(t,i,e,s){var o=this.imgCaching.getSettingType?this.imgCaching.getSettingType():"default",n=this.imgCaching.cachingNum?this.imgCaching.cachingNum:1,a=Math.floor(Math.LOG10E*Math.log((s-e+1)/t));0>a&&(a=0);var r=Math.pow(10,a)*POW_REG,h=Math.floor(Math.LOG10E*Math.log(Math.pow((s-e+1)/t/r*POW_REG,n))),l=Math.floor(n*Math.LOG10E*Math.log(POW_REG/1e4)+1);l>h&&(h=l);var d=Math.floor(POW_REG/Math.pow(10,h/n));return[o,d]},getJsonParsedData:function(t,i,e,s,o,n){var a=this.getJsonParsedDataStatus(i,e,s,o);return this.showLoading(t,i,s,o,n,a[1]),a},getJsonParsedDataStatus:function(t,i,e,s){var o=this.getName(),n=[],a=[],r=Math.floor(Math.LOG10E*Math.log((s-e+1)/t));0>r&&(r=0);for(var h=Math.pow(10,r)*POW_REG,l=Math.floor((e-1)/h),d=Math.floor((s-1)/h),c=Math.floor((this.chrSize[i][1]-1)/h),v=l;d>=v;v++)c>=v&&(this.ojson[r]&&this.ojson[r][i+"|"+v]&&this.ojson[r][i+"|"+v][o]?a.push(this.ojson[r][i+"|"+v][o]):v>=0&&n.push(v));return[a,n]},showLoading:function(t,i,e,s,o,n){for(var a=0;a<n.length;a++)this.paintLoading(t,i,e,s,o,n[a])},paintLoading:function(t,i,e,s,o,n){if(!(0>n)){var a=Math.floor(Math.LOG10E*Math.log((s-e+1)/i));0>a&&(a=0);var r=Math.pow(10,a)*POW_REG,h=n*r+1,l=(n+1)*r,d=(h-e)*(i-1)/(s-e+1);if(!(d>i)){0>d&&(d=0);var c=(l-e+1)*(i-1)/(s-e+1);if(!(0>c)){c>i-1&&(c=i-1);var v=t,g=v+this.height-1;if("-"==o){var p=i-1-d;d=i-1-c,c=p}this.imgObj.fillStyle="#DDDDDD",this.imgObj.fillRect(d,v,c-d+1,g-v+1);var u="Loading...";this.imgObj.font="10px 'Helvetica'";var f=this.imgObj.measureText(u).width;this.imgObj.fillStyle="#888888";var m,w=(v+g)/2+3;i/3>=d&&c>=2*i/3?m=(i-f)/2:d>=i/3&&c>=2*i/3?m=(d+2*i/3-f)/2:d>=i/3&&2*i/3>=c?m=(d+c-f)/2:i/3>=d&&2*i/3>=c&&(m=(i/3+c-f)/2),void 0!==m&&this.imgObj.fillText(u,m,w)}}}},paintError:function(t,i,e,s,o,n,a){if(!(0>n)){var r=Math.floor(Math.LOG10E*Math.log((s-e+1)/i));0>r&&(r=0);var h=Math.pow(10,r)*POW_REG,l=n*h+1,d=(n+1)*h,c=(l-e)*(i-1)/(s-e+1);if(!(c>i)){0>c&&(c=0);var v=(d-e+1)*(i-1)/(s-e+1);if(!(0>v)){v>i-1&&(v=i-1);var g=t,p=t+this.height-1;if("-"==o){var u=i-1-c;c=i-1-v,v=u}this.imgObj.fillStyle="#EEEEEE",this.imgObj.fillRect(c,g,v-c+1,p-g+1);var f=" Error: "+a;this.imgObj.font="10px 'Helvetica'";var m=this.imgObj.measureText(f).width;this.imgObj.fillStyle="#BB0000";var w=(g+p)/2,b=(i-1-m)/2;c>b&&(b=c),b+m>v&&(b=v-m),c>b&&(b=(c+v-m)/2),this.imgObj.fillText(f,b,w)}}}},setHeight:function(){},setHeightForCaching:function(t,i,e,s,o){var n=this.getForCachingData(t,i,e,s,o),a=(n[0],n[1],Math.floor(Math.LOG10E*Math.log((s-e+1)/t)));0>a&&(a=0);var r=Math.pow(10,a)*POW_REG,h=Math.floor((e-1)/r),l=Math.floor((s-1)/r),d=h*r+1,c=(l+1)*r,v=(c-d+1)/Math.pow(10,a);if(void 0!==this.setHeight2){var g=this.getJsonParsedDataStatus(t,i,e,s);this.setHeight2(g[0],v,i,d,c,o)}else this.setHeight(v,i,d,c,o)},getName:function(){return""},getKindName:function(){return this.getName()},getButtonInfo:function(){return{color:["eeeeee","ffcccc"],onOff:!1}},getPannelBgcolor:function(){return"#EEEEEE"},getItemDispName:function(){return this.getName()},getItemDetailName:function(){return this.getItemDispName()},getMenuPopup:function(){return""},getMenuDetail:function(){var t="";return t},setViewDetail:function(){return!0},getPopupData:function(){},getHeight:function(){return this.height},getAboidingLeftPanelSpace:function(){return 0},setImgJson:function(t,i,e){this.imgObj=t,this.ojson=i,this.chrSize=e},getLabelCol:function(){return"#000000"},cov16:function(t){var i="0123456789ABCDEF";return t>255?"FF":0>t?"00":i.charAt(Math.floor(t/16))+i.charAt(t%16)}};